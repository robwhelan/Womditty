<script src="http://js.pusher.com/2.1/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript">
  // Enable pusher logging - don't include this in production
 	var pusher = new Pusher('<%= Pusher.key %>'); // uses your APP KEY
  Pusher.log = function(message) {
    if (window.console && window.console.log) {
      window.console.log(message);
    }
  };

  var channel = pusher.subscribe('<%= @group.unique_identifier %>');
  channel.bind('new-post', function(data) {
	//alert(data.message);
	
	$('#chat').append(
	'<div class="row">' +
	'<div class="col-xs-2">' +
	'<img width=40 src=' + data.user_image + ' class="img-rounded" />' +
	'<p style="font-size:60%;margin:0;">' + data.user_name + '</p>' +
	'</div>' +
	'<div class="col-xs-10">' +
	'<p>' + data.message + '</p>' +
	'</div>' +
	'</div>')
	});

</script>

<%= link_to_next_page @posts, 'Load Older Posts', :params => { :forum => @forum, :group => @group }, :remote => true, :id => 'nextPageLink', :class => 'btn btn-default btn-block' %>

<div id="oldPosts">
<% @posts.reverse.each do |post| %>
<div class="row">
<div class="col-xs-2">
<img width=40 src=<%= post.user.profile_image %> class="img-rounded" />
<p style="font-size:60%;margin:0;"><%= post.user.name %></p>
<p style="font-size:40%;margin:0;"><%= distance_of_time_in_words_to_now(post.created_at.time) %> ago</p>
</div>
<div class="col-xs-10">
<p><%= post.body %></p>
</div>
</div>
<% end %>
</div>

<div id="chat" style="margin-bottom:60px;"></div>